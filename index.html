<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Canvas - MapMent</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" id="container">
        <div class="grid" id="grid">
            <svg id="arrow-svg">
                <defs>
                    <filter id="selection-glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"></feGaussianBlur>
                        <feFlood flood-color="var(--glow-color)" result="color"></feFlood>
                        <feComposite in="color" in2="blur" operator="in" result="glow"></feComposite>
                        <feMerge>
                            <feMergeNode in="glow"></feMergeNode>
                            <feMergeNode in="SourceGraphic"></feMergeNode>
                        </feMerge>
                    </filter>
                </defs>
            </svg>
        </div>
    </div>

    <div id="project-title" contenteditable="true">Untitled MapMent</div>
    <div id="page-title" contenteditable="true">Untitled Page</div>

    <div class="coordinates" id="coordinates" data-translate-key="coords_nothing">Nada selecionado</div>

    <div class="shortcut-hint" id="shortcut-hint" style="display: none;">
        <div class="hint-line"><span data-translate-key="hint_toggle">Pressione <kbd>H</kbd> para mostrar/esconder os atalhos</span></div><hr>
        <div class="hint-category" data-translate-key="hint_nav_title">Navegação e Visualização:</div>
        <div class="hint-line"><span data-translate-key="hint_pan">Segure <kbd>Shift</kbd> ou <kbd>Clique Meio</kbd> para mover o mapa</span></div>
        <div class="hint-line"><span data-translate-key="hint_zoom">Use o <kbd>Scroll</kbd> para dar zoom</span></div>
        <div class="hint-line"><span data-translate-key="hint_pages">Use <kbd>PageUp</kbd> / <kbd>PageDown</kbd> para mudar de página</span></div>
        <div class="hint-line"><span data-translate-key="hint_sidebar">Use <kbd>G</kbd> para esconder/mostrar painel lateral</span></div>
        <div class="hint-line"><span data-translate-key="hint_coords"><kbd>N</kbd> para esconder/mostrar coordenadas</span></div>
        <hr>
        <div class="hint-category" data-translate-key="hint_actions_title">Ações e Atalhos:</div>
        <div class="hint-line"><span data-translate-key="hint_add"><kbd>Shift</kbd> + <kbd>A</kbd> para adicionar conteúdo</span></div>
        <div class="hint-line"><span data-translate-key="hint_duplicate"><kbd>Shift</kbd> + <kbd>D</kbd> para duplicar/adicionar</span></div>
        <div class="hint-line"><span data-translate-key="hint_rename_block"><kbd>F2</kbd> / <kbd>R</kbd> para renomear o bloco</span></div>
        <div class="hint-line"><span data-translate-key="hint_add_slide"><kbd>Shift</kbd> + <kbd>+</kbd> para adicionar slide</span></div>
        <div class="hint-line"><span data-translate-key="hint_delete_slide"><kbd>Shift</kbd> + <kbd>-</kbd> para deletar slide</span></div>
        <div class="hint-line"><span data-translate-key="hint_smart_color"><kbd>B</kbd> para paleta de cores inteligente</span></div>
        <div class="hint-line"><span data-translate-key="hint_parent_move"><kbd>P</kbd> para ativar/desativar movimento em grupo</span></div>
        <div class="hint-line"><span data-translate-key="hint_delete"><kbd>Delete</kbd> para apagar itens</span></div>
        <div class="hint-line"><span data-translate-key="hint_undo"><kbd>Ctrl</kbd> + <kbd>Z</kbd> para desfazer</span></div>
        <div class="hint-line"><span data-translate-key="hint_redo"><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Z</kbd> para refazer</span></div>
        <div class="hint-line"><span data-translate-key="hint_save"><kbd>Ctrl</kbd> + <kbd>S</kbd> para salvar</span></div>
        <div class="hint-line"><span data-translate-key="hint_load"><kbd>Ctrl</kbd> + <kbd>L</kbd> para carregar</span></div>
    </div>

    <div class="sidebar">
        <div class="sidebar-section">
            <h4 data-translate-key="sidebar_blocks_list">Guia do Mapa Mental</h4>
            <div id="blocks-list-container">
                <ul id="blocks-list"></ul>
            </div>
            <div id="rename-block-form" class="hidden">
                <input type="text" id="rename-block-input" placeholder="Novo nome do bloco">
                <button class="page-btn" id="rename-block-btn" title="Confirmar">✓</button>
            </div>
        </div>
        <div class="sidebar-section">
            <h4 data-translate-key="sidebar_customize">Customizar</h4>
            <div id="customize-content">
                <div id="block-controls" class="control-group hidden">
                    <h5 data-translate-key="sidebar_block">Bloco</h5>
                    <label>
                        <span data-translate-key="sidebar_family">Família</span>
                        <div class="select-wrapper">
                             <select id="family-select"></select>
                        </div>
                    </label>
                    <label>
                        <span data-translate-key="sidebar_show_in_list">Mostrar na Lista</span>
                        <input type="checkbox" id="show-in-list-checkbox" checked>
                    </label>
                    <label><span data-translate-key="sidebar_background">Fundo</span><div class="color-picker-wrapper" data-color-target="blockBg"></div></label>
                    <label><span data-translate-key="sidebar_border">Borda</span><div class="color-picker-wrapper" data-color-target="blockBorder"></div></label>
                </div>
                <div id="handle-controls" class="control-group hidden"><h5 data-translate-key="sidebar_handles">Alças</h5><label><span data-translate-key="sidebar_color">Cor</span><div class="color-picker-wrapper" data-color-target="handle"></div></label><label><span data-translate-key="sidebar_visible">Beiradas visíveis</span><input type="checkbox" id="handle-visible" checked></label></div>
                <div id="text-controls" class="control-group hidden">
                    <h5 data-translate-key="sidebar_text">Texto</h5>
                    <div class="text-format-buttons">
                        <button id="bold-btn" class="format-btn"><b>B</b></button>
                        <button id="italic-btn" class="format-btn"><i>I</i></button>
                        <button id="underline-btn" class="format-btn"><u>U</u></button>
                    </div>
                    <label><span data-translate-key="sidebar_color">Cor</span><div class="color-picker-wrapper" data-color-target="text"></div></label>
                    <label>
                        <span data-translate-key="sidebar_size">Tamanho (px)</span>
                        <div class="select-wrapper">
                            <select id="text-size"></select>
                        </div>
                    </label>
                    <label>
                        <span data-translate-key="sidebar_font">Fonte</span>
                        <div class="select-wrapper">
                            <select id="text-font">
                                <option value="-apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" data-translate-key="font_default">Padrão</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="Courier New, monospace">Courier New</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                                <option value="Times New Roman, serif">Times New Roman</option>
                            </select>
                        </div>
                    </label>
                </div>
                <div id="link-controls" class="control-group hidden">
                    <h5 data-translate-key="sidebar_embed">Link Incorporado</h5>
                    <label><span>URL</span><input type="text" id="link-src"></label>
                </div>
                <div id="arrow-controls" class="control-group hidden">
                    <h5 data-translate-key="sidebar_arrow">Seta</h5>
                    <label><span data-translate-key="sidebar_color">Cor</span><div class="color-picker-wrapper" data-color-target="arrow"></div></label>
                    <label><span data-translate-key="sidebar_size">Tamanho</span><input type="range" id="arrow-width" min="1" max="10" step="1"></label>
                </div>
                <div id="grid-controls" class="control-group"><h5 data-translate-key="sidebar_grid">Grade</h5><label><span data-translate-key="sidebar_background">Fundo</span><div class="color-picker-wrapper" data-color-target="gridBg"></div></label><label><span data-translate-key="sidebar_lines">Linhas</span><div class="color-picker-wrapper" data-color-target="gridLines"></div></label></div>
            </div>
        </div>
        <div class="sidebar-section">
            <h4 data-translate-key="sidebar_families">Famílias</h4>
            <ul id="families-list"></ul>
            <div class="add-family-form">
                <input type="text" id="new-family-name" placeholder="Nome da nova família">
                <button class="page-btn" id="add-family-btn" title="Criar Família">+</button>
            </div>
        </div>
        <div class="sidebar-section">
            <h4 data-translate-key="sidebar_pages">Apresentação</h4>
            <div class="page-controls">
                <div class="page-controls-header">
                    <span id="page-info-display">Pág 1 / 1</span>
                    <div class="page-actions">
                        <button class="page-btn" id="prev-page-btn" title="Página Anterior (PageUp)">▲</button>
                        <button class="page-btn" id="next-page-btn" title="Próxima Página (PageDown)">▼</button>
                        <button class="page-btn" id="add-page-btn" title="Adicionar Nova Página (Shift +)">+</button>
                        <button class="page-btn" id="delete-page-btn" title="Deletar Página(s) (Delete)">🗑️</button>
                    </div>
                </div>
                <div id="pages-list-container"><ul id="pages-list"></ul></div>
            </div>
        </div>
        <div class="sidebar-section">
            <h4 data-translate-key="sidebar_actions">Ações</h4>
            <div class="actions-grid">
                <button class="control-btn" id="add-content-btn"><span class="btn-icon">+</span><span data-translate-key="btn_add_content">Adicionar</span></button>
                <button class="control-btn" id="toggle-arrow-mode-btn"><span class="btn-icon">→</span><span data-translate-key="btn_arrow_mode">Modo Seta</span></button>
                <button class="control-btn" id="save-btn"><span class="btn-icon">💾</span><span data-translate-key="btn_save">Salvar</span></button>
                <button class="control-btn" id="load-btn"><span class="btn-icon">📂</span><span data-translate-key="btn_load">Carregar</span></button>
                <button class="control-btn active" id="toggle-snap-btn"><span class="btn-icon">🧲</span><span data-translate-key="btn_snap">Encaixe</span></button>
                <button class="control-btn active" id="toggle-parent-move-btn" title="Ativar/Desativar Movimento em Grupo (P)"><span class="btn-icon">👨‍👩‍👧‍👦</span><span data-translate-key="btn_parent_move">Grupo</span></button>
            </div>
        </div>
    </div>

    <div id="context-menu">
        <!-- O conteúdo deste menu será gerado dinamicamente via JS -->
    </div>
    
    <input type="file" id="file-loader" accept=".json" style="display: none;">

    <div id="custom-color-picker" class="hidden">
        <div class="color-picker-header" data-translate-key="color_picker_title">Seletor de Cores</div>
        <div class="color-picker-body">
            <div class="color-spectrum" id="color-spectrum">
                <div class="spectrum-cursor" id="spectrum-cursor"></div>
            </div>
            <input type="range" min="0" max="360" value="0" class="color-slider hue-slider" id="hue-slider">
            <input type="range" min="0" max="1" value="1" step="0.01" class="color-slider opacity-slider" id="opacity-slider">
            <div class="color-inputs">
                <label for="hex-input">HEX</label>
                <input type="text" id="hex-input">
                <label for="rgba-input-r">RGBA</label>
                <div style="display: flex; gap: 2px;">
                    <input type="number" id="rgba-input-r" min="0" max="255">
                    <input type="number" id="rgba-input-g" min="0" max="255">
                    <input type="number" id="rgba-input-b" min="0" max="255">
                    <input type="number" id="rgba-input-a" min="0" max="1" step="0.1">
                </div>
            </div>
        </div>
        <div class="color-picker-footer">
            <button id="color-picker-cancel" data-translate-key="btn_cancel">Cancelar</button>
            <button id="color-picker-confirm" class="confirm-btn" data-translate-key="btn_confirm">Confirmar</button>
        </div>
    </div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script src="script.js"></script>
</body>
</html>